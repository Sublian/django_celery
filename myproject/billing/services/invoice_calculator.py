# billing/services/invoice_calculator.py
class InvoiceCalculatorService:
    def calculate_line_totals(self, line_data, billing_type, parameters):
        # Réplica de generate_lines con alta precisión
        pass
    
    def calculate_invoice_totals(self, invoice, lines_data):
        # Réplica de la lógica de totales del body_function_ebill
        pass
    
    def handle_advance_regularization(self, line_data, advance_data):
        # Manejo de anticipos y regularizaciones
        pass