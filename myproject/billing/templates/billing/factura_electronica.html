<!-- myproject\billing\templates\billing\factura_electronica.html  -->
{% extends "billing/base_pdf.html" %}

{% block title %}Factura Electrónica {{ serie_numero }}{% endblock %}

{% block extra_css %}
<!-- Solo enlaces a CSS si es necesario, pero mejor usar archivo externo -->
{% endblock %}

{% block content %}

<!-- ENCABEZADO DE EMPRESA - Se hereda de base_pdf -->

<!-- TÍTULO PRINCIPAL DE FACTURA -->
<div class="factura-title">FACTURA ELECTRÓNICA</div>
<div class="factura-number">{{ serie_numero }}</div>

<!-- SECCIÓN DE INFORMACIÓN DUAL COMPACTA -->
<div class="info-section">
    <table width="100%">
        <tr>
<!-- COLUMNA IZQUIERDA: Dirección de Facturación -->
            <td width="48%" class="info-column-left">
                <div class="info-title">Dirección De Facturación:</div>
                <div class="info-content">
                    <strong>{{ nombre_comercial|default:cliente }}</strong><br>
                    {{ direccion_cliente }}<br>
                    Celular: {{ celular|default:"N/A" }}<br>
                    RUC: {{ ruc_cliente }}
                </div>
            </td>
            
            <!-- SEPARADOR VERTICAL (nuevo) -->
            <td width="4%" class="vertical-separator">
                <div class="separator-line"></div>
            </td>
            
            <!-- COLUMNA DERECHA: Datos de Emisión -->
            <td width="48%" class="info-column-right">
                <div class="info-title">Datos de Emisión:</div>
                <table class="info-subtable">
                    <tr>
                        <td class="info-label">Fecha Emisión:</td>
                        <td class="info-value">{{ fecha_emision }}</td>
                    </tr>
                    <tr>
                        <td class="info-label"># Pedido:</td>
                        <td class="info-value">{{ identificador|default:"N/A" }}</td>
                    </tr>
                    <tr>
                        <td class="info-label">Forma De Pago:</td>
                        <td class="info-value">{{ metodo_pago|default:condiciones_pago|default:"Contado" }}</td>
                    </tr>
                    <tr>
                        <td class="info-label">F.Vencimiento:</td>
                        <td class="info-value">{{ fecha_vencimiento|default:"N/A" }}</td>
                    </tr>
                    <tr>
                        <td class="info-label">Periodo:</td>
                        <td class="info-value">{{ periodo|default:"N/A" }}</td>
                    </tr>
                    <tr>
                        <td class="info-label">O/C:</td>
                        <td class="info-value">{{ otros|default:"N/A" }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

<!-- DETALLE DE PRODUCTOS/SERVICIOS -->
<div class="items-table-container">
    <table class="items-table">
        <thead>
            <tr>
                <th width="5%">It</th>
                <th width="40%" class="text-left">Descripción</th>
                <th width="8%">Cant.</th>
                <th width="10%">Unidad</th>
                <th width="12%" class="text-right">P.Unitario</th>
                <th width="10%" class="text-right">Impuesto</th>
                <th width="15%" class="text-right">Precio</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr style="page-break-inside: avoid; page-break-after: auto;">
                <td class="text-center">{{ forloop.counter }}</td>
                <td class="text-left">
                    {{ item.descripcion }}
                    {% if item.codigo %}
                    <br><span class="small">Cód: {{ item.codigo }}</span>
                    {% endif %}
                    {% if item.codigo_producto_sunat %}
                    <br><span class="small">SUNAT: {{ item.codigo_producto_sunat }}</span>
                    {% endif %}
                </td>
                <td class="text-center">{{ item.cantidad|floatformat:2 }}</td>
                <td class="text-center">{{ item.unidad_de_medida }}</td>
                <td class="text-right">S/ {{ item.precio_unitario|floatformat:2 }}</td>
                <td class="text-right">S/ {{ item.igv|default:"0.00"|floatformat:2 }}</td>
                <td class="text-right">S/ {{ item.subtotal|floatformat:2 }}</td>
            </tr>
            
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="clear"></div>

<!-- SECCIÓN CON QR A LA IZQUIERDA Y RESUMEN A LA DERECHA -->
<table width="100%" style="border: none; margin-top: 6px;">
    <tr>
        <!-- COLUMNA IZQUIERDA: QR -->
        <td width="55%" style="vertical-align: top; border: none; padding: 0;">
            <div class="qr-left-section">
                <div class="qr-container">
                    <div class="qr-placeholder">
                        {% if qr_data %}
                        CÓDIGO QR<br>
                        <small>({{ qr_data|truncatechars:15 }})</small>
                        {% else %}
                        <div style="display: inline-block; width: 70px; height: 70px; position: relative;">
                            <!-- Dibujo simple de QR -->
                            <div style="position: absolute; top: 8px; left: 8px; width: 54px; height: 54px; border: 1px solid #333; background: repeating-linear-gradient(0deg, transparent, transparent 6px, #333 6px, #333 12px), repeating-linear-gradient(90deg, transparent, transparent 6px, #333 6px, #333 12px);"></div>
                            <div style="position: absolute; top: 12px; left: 12px; width: 46px; height: 46px; border: 1px solid #333;"></div>
                            <div style="position: absolute; top: 20px; left: 20px; width: 30px; height: 30px; background-color: #333;"></div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="hash-info">
                        <strong>Código Hash:</strong> {{ codigo_unico|default:"Generado por SUNAT" }}<br>
                        <strong>Fecha de emisión:</strong> {{ fecha_emision }}
                    </div>
                </div>
                
                <!-- OBSERVACIONES debajo del QR -->
                {% if observaciones %}
                <div class="observations" style="margin-top: 6px;">
                    <strong>Observaciones:</strong><br>
                    {{ observaciones|linebreaksbr }}
                </div>
                {% endif %}
            </div>
        </td>
        
        <!-- COLUMNA DERECHA: RESUMEN DE IMPORTES -->
        <td width="45%" style="vertical-align: top; border: none; padding: 0 0 0 8px;">
            <table class="summary-table">
                <tr>
                    <td colspan="2" class="summary-header">RESUMEN DE IMPORTES</td>
                </tr>
                <tr>
                    <td class="summary-row summary-label">Op. Gravadas:</td>
                    <td class="summary-row summary-value">S/ {{ totales.gravada }}</td>
                </tr>
                <tr>
                    <td class="summary-row summary-label">Op. Inafectas:</td>
                    <td class="summary-row summary-value">S/ {{ total_inafecta|default:"0.00" }}</td>
                </tr>
                <tr>
                    <td class="summary-row summary-label">Op. Exoneradas:</td>
                    <td class="summary-row summary-value">S/ {{ total_exonerada|default:"0.00" }}</td>
                </tr>
                <tr>
                    <td class="summary-row summary-label">Op. Gratuitas:</td>
                    <td class="summary-row summary-value">S/ {{ total_gratuita|default:"0.00" }}</td>
                </tr>
                <tr>
                    <td class="summary-row summary-label">Descuentos:</td>
                    <td class="summary-row summary-value">S/ {{ totales.descuento|default:"0.00" }}</td>
                </tr>
                <tr>
                    <td class="summary-row summary-label">IGV (18%):</td>
                    <td class="summary-row summary-value">S/ {{ totales.igv }}</td>
                </tr>
                <tr>
                    <td class="summary-total summary-label">IMPORTE TOTAL:</td>
                    <td class="summary-total summary-value">S/ {{ totales.total }}</td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<div class="clear"></div>

<!-- CONDICIONES DE CRÉDITO -->
{% if venta_al_credito %}
<div style="background-color: #e3f2fd; border: 1px solid #bbdefb; border-radius: 3px; padding: 4px; margin: 10px 0 6px 0; font-size: 6pt;">
    <strong style="color: #1565c0;">Condiciones de Crédito:</strong>
    <table style="width: 100%; border: none; margin-top: 2px; font-size: 6pt;">
        {% for cuota in venta_al_credito %}
        <tr>
            <td style="border: none; padding: 0px 0; width: 50px;">Cuota {{ cuota.cuota }}:</td>
            <td style="border: none; padding: 0px 0;">{{ cuota.fecha_de_pago }}</td>
            <td style="border: none; padding: 0px 0; text-align: right;">S/ {{ cuota.importe|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

{% endblock %}

{% block footer %}
<div style="font-size: 5pt; color: #666; text-align: center; border-top: 1px solid #ccc; padding-top: 2px; margin-top: 8px;">
    <p>
        <strong>Documento Electrónico generado por sistema.</strong><br>
        Representación impresa del Comprobante de Pago Electrónico - {{ serie_numero }}
    </p>
    <p style="font-size: 5pt;">
        Fecha de generación: {% now "d/m/Y H:i" %} | 
        Usuario: {{ user|default:"Sistema" }} |
        Página <pdf:pagenumber> de <pdf:pagecount>
    </p>
</div>

<!-- LEYENDA LEGAL -->
<div class="legal-text">
    <strong>LEYENDA:</strong> Esta factura electrónica ha sido generada y autorizada conforme a la Ley N° 28035, Ley de Firmas y Certificados Digitales, y a la Resolución de Superintendencia N° 007-2006/SUNAT. Representación impresa del comprobante de pago electrónico. Para consultar la validez del comprobante, ingresar a https://www.sunat.gob.pe/ o escanear el código QR.
</div>
{% endblock %}